<!DOCTYPE html>
<html>
<head>
  <title>Extension Test Page</title>
  <style>
    body { font-family: Arial; padding: 40px; background: #f5f5f5; }
    .card { background: white; padding: 30px; border-radius: 12px; max-width: 600px; margin: 0 auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #667eea; }
    .status { padding: 15px; margin: 15px 0; border-radius: 8px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; }
    button:hover { background: #5568d3; }
    pre { background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üß™ Extension Test Page</h1>
    <p>Use this page to verify the extension is working</p>
    
    <div id="status"></div>
    
    <h3>Tests:</h3>
    <button onclick="testServer()">1. Test Server Connection</button>
    <button onclick="testExtension()">2. Test Extension Loaded</button>
    <button onclick="sendTestEvent()">3. Send Test Event</button>
    
    <h3>Results:</h3>
    <pre id="results">Click buttons above to run tests...</pre>
  </div>
  
  <script>
    async function testServer() {
      const results = document.getElementById('results');
      const status = document.getElementById('status');
      
      try {
        const response = await fetch('http://localhost:8000/events');
        if (response.ok) {
          const data = await response.json();
          results.textContent = '‚úÖ Server is running!\n\n' + JSON.stringify(data, null, 2);
          status.innerHTML = '<div class="status success">‚úÖ Server connection successful</div>';
        }
      } catch (error) {
        results.textContent = '‚ùå Server not running\n\nError: ' + error.message;
        status.innerHTML = '<div class="status error">‚ùå Cannot connect to server. Run: python unified_server.py</div>';
      }
    }
    
    function testExtension() {
      const results = document.getElementById('results');
      const status = document.getElementById('status');
      
      if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
        results.textContent = '‚úÖ Extension is loaded!\n\nExtension ID: ' + chrome.runtime.id;
        status.innerHTML = '<div class="status success">‚úÖ Extension detected</div>';
      } else {
        results.textContent = '‚ùå Extension not detected';
        status.innerHTML = '<div class="status error">‚ùå Extension not loaded. Check chrome://extensions/</div>';
      }
    }
    
    async function sendTestEvent() {
      const results = document.getElementById('results');
      const status = document.getElementById('status');
      
      try {
        const response = await fetch('http://localhost:8000/event', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            event_type: 'email_compose',
            url: 'https://mail.google.com/test',
            email_subject: 'Test from Extension Test Page',
            email_body: 'This is a test event',
            email_to: 'test@example.com'
          })
        });
        
        if (response.ok) {
          results.textContent = '‚úÖ Test event sent successfully!\n\nCheck dashboard: http://localhost:8000/dashboard';
          status.innerHTML = '<div class="status success">‚úÖ Event sent! Check the dashboard.</div>';
        }
      } catch (error) {
        results.textContent = '‚ùå Failed to send event\n\nError: ' + error.message;
        status.innerHTML = '<div class="status error">‚ùå Server not responding</div>';
      }
    }
    
    // Auto-test on load
    window.onload = () => {
      testServer();
    };
  </script>
</body>
</html>
